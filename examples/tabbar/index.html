<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Tabbar | Onsen UI</title>
    <link rel="stylesheet" href="../../build/css/onsenui.css">
    <link rel="stylesheet" href="../../build/css/onsen-css-components.css">

    <script src="../../build/js/onsenui.js"></script>

    <script>
      document.addEventListener('init', function(event) {
        console.log('init');

        if (event.target.matches('#p2')) {
          document.querySelector('#my-list').delegate = {
            createItemContent: function(i, template) {
              var dom = template.cloneNode(true);

              dom.innerHTML = dom.innerHTML.replace('{{item}}', i===5?i+fixedJump:(i + jump(i)));
              dom.setAttribute('index', i);

              return dom;
            },

            countItems: function() {
              return 10000000;
            }
          };

        }
      });
      document.addEventListener('show', function(event) {
        console.log('show');
      });
      document.addEventListener('hide', function(event) {
        console.log('hide');
      });
      document.addEventListener('destroy', function(event) {
        console.log('destroy');
      });

    </script>

    <script>
      var fixedJump = '';
var jump = (function() {
  var memoize = [];
  return function(i) {
    if (memoize[i] === undefined) {
      memoize[i] = Array(1 + Math.floor(Math.random() * 5)).join('<br>');
    }
    return memoize[i];
  };
})();
var test = function() {
  fixedJump = Array(10).join('<br>');
}

function refresh(i) {
  document.querySelector('#my-list').refresh(i);
}

</script>

  </head>

  <body>
    <ons-page>
      <ons-toolbar>
        <div class="center">Tabbar</div>
      </ons-toolbar>

      <ons-tabbar position="auto">
        <ons-tab page="page1.html" active
          icon="ion-home"
          active-icon="md-menu"
          label="Home">
        </ons-tab>
        <ons-tab
          icon="ion-chatbox-working"
          label="Comments"
          badge="99+"
          page="page2.html"></ons-tab>
        <ons-tab
          icon="ion-ios-cog"
          label="Settings"
          page="page3.html"></ons-tab>
      </ons-tabbar>
    </ons-page>

    <ons-template id="page1.html">
      <ons-page>
        <h2>Page1</h2>
      </ons-page>
    </ons-template>

    <ons-template id="page2.html">
      <ons-page id="p2">
        <h2>Page2</h2>

        <ons-list>
          <ons-lazy-repeat id="my-list">
            <ons-list-item>
              {{item}}
            </ons-list-item>
          </ons-lazy-repeat>
        </ons-list>

      </ons-page>
    </ons-template>

    <ons-template id="page3.html">
      <ons-page>
        <h2>Page3</h2>
      </ons-page>
    </ons-template>

  </body>
</html>
